# Determining average spending of the top 5 customers within the top 10 cities, countries

SELECT AVG(total_amount_paid.total_amount_paid) AS average
FROM
(SELECT A.customer_id,
     B.first_name,
	   B.last_name,
	   E.country,
	   D.city,
	   SUM(amount) AS total_amount_paid
FROM payment A
INNER JOIN customer B on A.customer_id=B.customer_id
INNER JOIN address C on B.address_id=C.address_id
INNER JOIN city D on C.city_id=D.city_id
INNER JOIN country E on D.country_id=E.country_id
WHERE E.country IN ('India', 'China', 'United States', 'Japan', 'Mexico',
				   'Brazil', 'Russian Federation', 'Philippines', 'Turkey', 'Indonesia')
AND D.city IN ('Aurora', 'Atlixco', 'Xintai', 'Adoni', 'Dhule (Dhulia)',
			  'Kurashiki', 'Pingxiang', 'Sivas', 'Celaya', 'So Leopoldo')
GROUP BY A.customer_id,
         B.first_name,
		     B.last_name,
		     E.country,
		     D.city
ORDER BY total_amount_paid DESC
LIMIT 5) AS total_amount_paid
